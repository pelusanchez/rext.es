var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in c||(c[f]={});c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof f?a:new f(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(p){this.asyncThrow_(p)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var f=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(q){b.reject(q)}};f.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};f.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof f)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};f.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(q){this.reject_(q);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};f.prototype.reject_=function(a){this.settle_(2,a)};f.prototype.fulfill_=function(a){this.settle_(1,a)};f.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)k.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var k=new b;f.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};f.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(p){c.reject(p)}};f.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(l){g(l)}}:b}var d,g,m=new f(function(a,b){d=a;g=b});this.callWhenSettled_(c(a,d),c(b,g));return m};
f.prototype.catch=function(a){return this.then(void 0,a)};f.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?k.asyncExecute(c):this.onSettledCallbacks_.push(c)};f.resolve=c;f.reject=function(a){return new f(function(b,c){c(a)})};f.race=function(a){return new f(function(b,d){for(var f=$jscomp.makeIterator(a),g=f.next();!g.done;g=f.next())c(g.value).callWhenSettled_(b,
d)})};f.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new f(function(a,f){function g(b){return function(c){k[b]=c;m--;0==m&&a(k)}}var k=[],m=0;do k.push(void 0),m++,c(d.value).callWhenSettled_(g(k.length-1),f),d=b.next();while(!d.done)})};return f},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
(function(a){function b(a){var b=a[2]*a[1];var c=b*(1-Math.abs(a[0]/60%2-1));var d=a[2]-b;if(180>a[0])if(60>a[0]){var e=a[2];var h=c+d;a=d}else 120>a[0]?(e=c+d,h=a[2],a=d):(e=d,h=a[2],a=c+d);else 240>a[0]?(e=d,h=c+d,a=a[2]):300>a[0]?(e=c+d,h=d,a=b+d):(e=b+d,h=d,a=c+d);return[0>e?0:1<e?1:e,0>h?0:1<h?1:h,0>a?0:1<a?1:a]}function c(a){Popup.show({header:"Se ha producido un error",body:a})}function d(a,b,c){b=a.createShader(b);a.shaderSource(b,c);a.compileShader(b);if(a.getShaderParameter(b,a.COMPILE_STATUS))return b;
console.log(a.getShaderInfoLog(b));a.deleteShader(b)}function f(a,b,d){var h=a.createProgram();a.attachShader(h,b);a.attachShader(h,d);a.linkProgram(h);if(a.getProgramParameter(h,a.LINK_STATUS))return h;console.log(a.getProgramInfoLog(h));a.deleteProgram(h);c("createProgram Error")}function k(a){var b=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);return b}function m(a){return a.reduce(function(a,b){return a+b})}function n(h,y,D){function g(){e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,256,1,0,e.ALPHA,e.UNSIGNED_BYTE,new Uint8Array(w));e.useProgram(r);e.enableVertexAttribArray(n);e.bindBuffer(e.ARRAY_BUFFER,t);e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0);e.enableVertexAttribArray(p);e.bindBuffer(e.ARRAY_BUFFER,C);e.vertexAttribPointer(p,2,e.FLOAT,!1,0,0);e.uniform2f(F,
x,z);e.uniform2f(H,x,z);e.uniform1f(I,Params.get("brightness"));e.uniform1f(J,Params.get("exposure"));e.uniform1f(K,Params.get("contrast"));e.uniform1f(L,Params.get("saturation"));e.uniform1f(M,Params.get("masking"));e.uniform1f(N,Params.get("dehaze"));e.uniform1f(O,Params.get("atmosferic_light"));e.uniform3fv(P,u.concat(b([360*Params.get("lightColor"),Params.get("lightSat"),Params.get("lightFill")])).concat(b([360*Params.get("darkColor"),Params.get("darkSat"),Params.get("darkFill")])));e.uniform1f(Q,
Params.get("bAndW"));e.uniform1f(T,Params.get("hdr"));e.uniform1i(U,0);e.uniform1i(V,1);e.uniform1fv(aa,v);e.uniform1f(ba,m(v));e.drawArrays(e.TRIANGLES,0,6)}var e=y||a.__gl;y=d(e,e.VERTEX_SHADER,__SHADERS__.VERTEX);var l=d(e,e.FRAGMENT_SHADER,__SHADERS__.FRAGMENT);try{var r=f(e,y,l)}catch(A){return c(A)}var n=e.getAttribLocation(r,"a_position"),p=e.getAttribLocation(r,"a_texCoord"),t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t);var x=h.width,z=h.height;e.canvas.width=x;e.canvas.height=z;console.log("[IMAGE] width = "+
x+", height = "+z);q(e,0,0,x,z);var C=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,C);e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW);e.activeTexture(e.TEXTURE0);k(e);try{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,h)}catch(A){return c(A)}var U=e.getUniformLocation(r,"u_image"),F=e.getUniformLocation(r,"u_resolution"),H=e.getUniformLocation(r,"u_textureSize"),aa=e.getUniformLocation(r,"u_kernel[0]"),ba=e.getUniformLocation(r,"u_kernelWeight"),J=
e.getUniformLocation(r,"u_exposure"),I=e.getUniformLocation(r,"u_brightness"),K=e.getUniformLocation(r,"u_contrast"),L=e.getUniformLocation(r,"u_saturation"),M=e.getUniformLocation(r,"u_masking"),N=e.getUniformLocation(r,"u_dehaze"),O=e.getUniformLocation(r,"u_atmosferic_light"),P=e.getUniformLocation(r,"u_temptint[0]"),Q=e.getUniformLocation(r,"u_bAndW"),T=e.getUniformLocation(r,"u_hdr"),V=e.getUniformLocation(r,"u_lut");e.activeTexture(e.TEXTURE1);k(e);a.updatePhoto=function(){return g()};e.viewport(0,
0,x,z);e.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT);D||g()}function q(a,b,c,d,e){d=b+d;e=c+e;a.bufferData(a.ARRAY_BUFFER,new Float32Array([b,c,d,c,b,e,b,e,d,c,d,e]),a.STATIC_DRAW)}function p(b){var d=UI.loadingHandler();g=new Image;g.src=b;g.onload=function(){if(1E7<g.width*g.height){var a=g.height/g.width;g.height=parseInt(Math.sqrt(1E7*a));g.width=parseInt(g.height/a)}};var h=new Image;h.onerror=function(){d.end();c("Error al cargar la imagen.")};h.onload=function(){d.set(30);try{var b=document.createElement("canvas");
if(2E6<h.height*h.width){var e=Math.sqrt(2E6*h.height/h.width);b.width=h.width/h.height*e;b.height=e}else b.width=h.width,b.height=h.height;d.set(40);var f=b.getContext("2d");f.imageSmoothingEnabled=1;f.drawImage(h,0,0,b.width,b.height);d.set(60);var y=new Image;y.src=b.toDataURL("image/png");d.set(80);y.onload=function(){d.end();UI.setImageLoaded(!0);n(y,a.gl)}}catch(E){c(E),d.end()}};h.src=b;d.set(20)}a.requestAnimationFrame=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||
a.msRequestAnimationFrame||function(a){setTimeout(a,20)};var g=null,u=[1,1,1],v=[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],t=t||{};t.kernel_update=function(){var a=-Params.get("sharpen"),b=Params.get("sharpen_radius"),c=Params.get("radiance"),d=Params.get("hdr");0!=c&&(a-=.5*c,b+=.5*c);0!=d&&(a-=.5*d,b+=.5*d);c=a*Math.exp(-Math.pow(1/b,2));d=a*Math.exp(-Math.pow(1.41/b,2));var e=a*Math.exp(-Math.pow(2/b,2)),f=a*Math.exp(-Math.pow(2.24/b,2));b=a*Math.exp(-Math.pow(2.83/b,2));var g=1;0>a&&
(g+=4*Math.abs(b)+8*Math.abs(f)+4*Math.abs(e)+4*Math.abs(d)+4*Math.abs(c));v=[b,f,e,f,b,f,d,c,d,f,e,c,g,c,e,f,d,c,d,f,b,f,e,f,b]};t.updateTemptint=function(){var a=Params.get("temperature"),b=Params.get("tint");0>a?(R=1,a=[[.6167426069865002,.017657981710823077],[.5838624982041293,.06447754787874993],[.5666570157784903,.1010769359975838],[.5600215017846518,.13012054359808795],[.5603460901328465,.15370282338343416],[.5651414015638195,.1734071109259789],[.5727157905223393,.19040417876076665],[.5819305919306469,
.20554787970182647],[.5920253173976543,.219454396860673],[.6024964973113273,.23256361077001078],[.613014923688415,.2451851574423344],[.6233694681448863,.2575325541865392],[.633428991849502,.2697484189519574],[.6431164873163056,.2819231700046263],[.6523914777767198,.29410898225476145],[.6612380004437802,.30633028466830314],[.6696563786680246,.31859171532935343],[.6776575761390952,.330884185957384],[.6852593188363603,.34318952105568623],[.6924834326806721,.3554840067292358],[.6993540206164168,.36774109382812364],
[.705896221219359,.37993343721079975],[.712135371070854,.3920344089104195],[.7180964477199883,.4040191918024166],[.7238037074478182,.41586553788423575],[.7292804578150028,.42755425869079605],[.7345489228275083,.43906950280216533],[.7396301709912545,.4503988656030025],[.7445440852278651,.4615333686006381],[.7493093597375261,.47246733915721345],[.7539435132044948,.4831982160881075],[.7584629107855697,.4937263019887011],[.7628827894765442,.5040544792219176],[.7672172829757861,.5141879031216875],[.7756812566990368,
.5339005596070674],[.7756812566990368,.5339005596070674],[.7798336535847834,.5434985836882681],[.7839465092903851,.552938802301879],[.7880286368234596,.5622329533372938],[.7920877696863722,.5713931712543325],[.796130534601134,.5804317041849897],[.8001624136045166,.5893606423074715],[.8041876951180534,.5981916567442426],[.8082094136732589,.6069357478075997],[.8122292780585781,.6156030011340633],[.8162475877574743,.624202350096731],[.8202631376804659,.6327413428542148],[.8242731113661302,.6412259124772712],
[.8282729630469863,.6496601487868902],[.8322562892583072,.6580460708395705],[.8362146910181553,.6663833994084263],[.8401376280395388,.6746693293369075],[.8440122669563406,.6828983022904387],[.8478233261635671,.691061781205187],[.8515529205921868,.6991480286361483],[.8578515274860328,.7143328511178657],[.8630349166004683,.7236145588845],[.8630349166004683,.7236145588845],[.8678866519883774,.7326305266929798],[.8724265417351438,.7413920824039555],[.8766746938112879,.7499106260961086],[.8806514255414362,
.7581975699581189],[.8843771730729832,.7662642858505886],[.8878724008449614,.7741220599147951],[.8911575110568668,.7817820536219475],[.8942527531374216,.7892552706795768],[.8971781332133792,.7965525292390034],[.9025975721615955,.8106613818669473],[.9051296119968262,.8174934982533621],[.9051296119968262,.8174934982533621],[.9075675706910422,.8241906743465228],[.9099288798932852,.8307625342003426],[.912230184763394,.8372184337382709],[.914487253441016,.8435674571884941],[.9167148865142485,.8498184155292972],
[.9189268264883301,.8559798466723794],[.9211356672547586,.862060017138353],[.9233527635598611,.8680669250033681],[.9278504028585166,.8798916280267886],[.9301466448383797,.8857241176152066],[.9324823592671754,.8915127453709542],[.9348613471976668,.8972642431099969],[.9348613471976668,.8972642431099969],[.9372856273504615,.9029851088748369],[.9397553455825536,.9086816143048344],[.9422686843563701,.9143598121965675],[.9448217722084058,.9200255441824128],[.947408593218177,.925684448465339],[.9500208964767429,
.931341967556689],[.9552772279767501,.9426736878435626],[.9578927646784257,.9483578644262163],[.9604766194871308,.954060621455171],[.9630080085847714,.9597865363484674],[.965463369977889,.9655400352277332],[.965463369977889,.9655400352277332],[.9678162729662736,.9713253997462401],[.9700373276119754,.9771467737131783],[.9720940942080452,.9830081695063213],[.9739509927471266,.9889134742677088],[.97556921239073,.9948664558790756],[.9782396416593983,1]][parseInt(100*(a+1))],G=a[0],B=a[1]):(R=.0438785/
Math.pow(a+.150127,1.23675)+.543991,G=.0305003/Math.pow(a+.163976,1.23965)+.69136,B=1);-1==b&&(b=-.99);G+=b;b=1/(.2126*R+.7152*G+.0722*B);u=[R*b,G*b,B*b]};var w=function(){for(var a=[],b=0;256>b;b++)a[b]=b;return a}();t.generateLightning=function(){var a=Params.get("blacks"),b=Params.get("shadows"),c=Params.get("highlights"),d=Params.get("whites"),e=Params.get("radiance");a=getCuadraticFunction(a,b+.33,c+.66,d+1,0,.33,.66,1);if(0!=e)var f=getCuadraticFunction(0,.33-.11*e,.66+.11*e,1,0,.33,.66,1);
for(e=0;256>e;e++)b=e/256,1<b&&(b=1),0>b&&(b=0),1<b&&(b=1),0>b&&(b=0),f&&(b=f(b)),b=a(b),1<b&&(b=1),0>b&&(b=0),w[e]=255*b};var l=l||{};l.reset=function(){if(confirm("Desea reiniciar los ajustes?")){Params.reset();for(var a=document.getElementsByClassName("range"),b=a.length;b--;){var c=a[b].getAttribute("data");a[b].value=Params.get(c);a[b].getAttribute("data-callback")&&l.callCallbacks(a[b].getAttribute("data-callback"))}updatePhoto()}};l.downloadSecondStep=function(){var b=document.getElementById("image-name").value;
Popup.hide();b||(b="image");b+=".jpg";var c=UI.loadingHandler(),d=document.getElementById("image_main");d.width=g.width;d.height=g.height;c.set(10);n(g,a.__gl,!0);c.set(40);setTimeout(function(){c.set(70);updatePhoto();d.toBlob(function(a){c.set(90);a=URL.createObjectURL(a);var d=document.createElement("a");d.href=a;d.download=b;document.body.append(d);d.click();document.body.removeChild(d);URL.revokeObjectURL(a);a=null;setTimeout(function(){c.end();n(g)},2E3)},"image/jpeg",.95)},2E3)};l.download=
function(){Popup.show({header:Locale.get("image_save_title"),bodyHTML:Locale.get("image_save_text")+'<br><input type="text" id="image-name" placeholder="Nombre de la imagen">',onEnterCallback:l.downloadSecondStep,buttons:[{text:"Aceptar",callback:l.downloadSecondStep}]}).then(function(){document.getElementById("image-name").focus()})};l.callCallbacks=function(a){a.split(",").forEach(function(a){t[a]()})};l.setParam=function(a){if(!UI.isImageLoaded())return c(Locale.get("image_no_loaded"));var b=document.getElementById("cantidad");
b&&(b.innerHTML=Locale.get(a.paramName)+": "+Math.round(100*a.value)/100);a.save&&l.history.push({paramName:a.paramName,value:Params.get(a.paramName),callbacks:a.callbacks});Params.set(a.paramName,a.value);a.callbacks&&l.callCallbacks(a.callbacks);updatePhoto()};l.timeOutSliderInfo=null;l.sliderCallback=function(a){l.setParam({paramName:this.getAttribute("data"),value:this.value,callbacks:this.getAttribute("data-callback"),save:!0})};l.history={hist:[],currCur:0,push:function(a){a.updateTime=+new Date;
0<this.currCur&&this.hist[this.currCur-1].paramName==a.paramName&&1E3>+new Date-this.hist[this.currCur-1].updateTime?this.hist[this.currCur-1]=a:(50<this.hist.length&&this.hist.splice(0,hist.length-50),a.save=!1,this.currCur=this.hist.push(a))},undo:function(){if(!(1>this.currCur)){var a=this.hist[--this.currCur];l.setParam(a)}},redo:function(){if(!(this.currCur>=this.hist.length)){var a=this.hist[++this.currCur];l.setParam(a)}}};window.__BOOT__=function(){imageElm=document.getElementById("image_main");
a.__gl=imageElm.getContext("webgl")||imageElm.getContext("experimental-webgl");a.__gl||alert("Error: No webgl detected");document.getElementById("image_data").addEventListener("change",function(b){b=b||a.event;new FileReader;b.target.files[0]&&p(URL.createObjectURL(b.target.files[0]))});for(var b=document.getElementsByClassName("slider"),c=b.length;c--;)b[c].addEventListener("input",l.sliderCallback)};window.__ERROR=c;window.Actions=l;window.isMobile=function(){return/mobile|android|iphone|ipad|ipod|kindle|symbian/i.test(navigator.userAgent||
navigator.vendor||a.opera)};var x=x||{};x.getParamValue=function(a){return Params.get(a)};window.Editor=x})(window);function res_treatment(a){for(var b=a.length,c=0;c<b;c++)a[c]=Math.round(1E3*a[c])/1E3;return a}
top.getCuadraticFunction=function(a,b,c,d,f,k,m,n){f=void 0===f?0:f;k=void 0===k?.33:k;m=void 0===m?.66:m;n=void 0===n?1:n;var q=Math.pow(f,2),p=Math.pow(k,2),g=Math.pow(m,2),u=Math.pow(n,2),v=res_treatment(preSolve4([q*f,p*k,g*m,u*n],[q,p,g,u],[f,k,m,n],[a,b,c,d]));return function(a){var b=v[3],c=a;b+=v[2]*c;c*=a;b+=v[1]*c;return b+=v[0]*c*a}};
function preSolve4(a,b,c,d){var f=c[2]-c[3],k=a[2]-a[3],m=b[2]-b[3],n=d[2]-d[3],q=b[2]*c[3]-c[2]*b[3],p=a[2]*c[3]-c[2]*a[3],g=a[2]*b[3]-b[2]*a[3],u=d[2]*c[3]-c[2]*d[3],v=d[2]*b[3]-b[2]*d[3],t=a[2]*d[3]-d[2]*a[3],w=b[2]*d[3]-d[2]*b[3],l=c[2]*d[3]-d[2]*c[3];W=b[1]*f-c[1]*m+q;X=a[1]*f-c[1]*k+p;Y=a[1]*m-b[1]*k+g;Z=a[1]*q-b[1]*p+c[1]*g;_S=a[0]*W-b[0]*X+c[0]*Y-Z;S=b[1]*f-c[1]*m+q;X=d[1]*f-c[1]*n+u;Y=d[1]*m-b[1]*n+v;Z=d[1]*q-b[1]*u+c[1]*v;_W=d[0]*S-b[0]*X+c[0]*Y-Z;W=d[1]*f-c[1]*n+u;S=a[1]*f-c[1]*k+p;Y=a[1]*
n-d[1]*k+t;Z=a[1]*u-d[1]*p+c[1]*t;_X=a[0]*W-d[0]*S+c[0]*Y-Z;W=b[1]*n-d[1]*m+w;X=a[1]*n-d[1]*k+t;S=a[1]*m-b[1]*k+g;Z=a[1]*w-b[1]*t+d[1]*g;_Y=a[0]*W-b[0]*X+d[0]*S-Z;W=b[1]*l-c[1]*w+d[1]*q;X=a[1]*l-c[1]*t+d[1]*p;Y=a[1]*w-b[1]*t+d[1]*g;S=a[1]*q-b[1]*p+c[1]*g;_Z=a[0]*W-b[0]*X+c[0]*Y-d[0]*S;return[_W/_S,_X/_S,_Y/_S,_Z/_S]}
function solve4(a,b,c,d,f){var k=c[2]*d[3]-d[2]*c[3],m=b[2]*d[3]-d[2]*b[3],n=b[2]*c[3]-c[2]*b[3],q=a[2]*d[3]-d[2]*a[3],p=a[2]*c[3]-c[2]*a[3],g=a[2]*b[3]-b[2]*a[3],u=f[2]*d[3]-d[2]*f[3],v=f[2]*c[3]-c[2]*f[3],t=f[2]*b[3]-b[2]*f[3],w=a[2]*f[3]-f[2]*a[3],l=b[2]*f[3]-f[2]*b[3],x=c[2]*f[3]-f[2]*c[3];W=b[1]*k-c[1]*m+d[1]*n;X=a[1]*k-c[1]*q+d[1]*p;Y=a[1]*m-b[1]*q+d[1]*g;Z=a[1]*n-b[1]*p+c[1]*g;_S=a[0]*W-b[0]*X+c[0]*Y-d[0]*Z;S=b[1]*k-c[1]*m+d[1]*n;X=f[1]*k-c[1]*u+d[1]*v;Y=f[1]*m-b[1]*u+d[1]*t;Z=f[1]*n-b[1]*
v+c[1]*t;_W=f[0]*S-b[0]*X+c[0]*Y-d[0]*Z;W=f[1]*k-c[1]*u+d[1]*v;S=a[1]*k-c[1]*q+d[1]*p;Y=a[1]*u-f[1]*q+d[1]*w;Z=a[1]*v-f[1]*p+c[1]*w;_X=a[0]*W-f[0]*S+c[0]*Y-d[0]*Z;W=b[1]*u-f[1]*m+d[1]*l;X=a[1]*u-f[1]*q+d[1]*w;S=a[1]*m-b[1]*q+d[1]*g;Z=a[1]*l-b[1]*w+f[1]*g;_Y=a[0]*W-b[0]*X+f[0]*S-d[0]*Z;W=b[1]*x-c[1]*l+f[1]*n;X=a[1]*x-c[1]*w+f[1]*p;Y=a[1]*l-b[1]*w+f[1]*g;S=a[1]*n-b[1]*p+c[1]*g;_Z=a[0]*W-b[0]*X+c[0]*Y-f[0]*S;return[_W/_S,_X/_S,_Y/_S,_Z/_S]}var Popup=Popup||{};
Popup.setHeader=function(a){a?(Popup.elements.popupHeader.style.display="",Popup.elements.popupHeader.innerText=a):Popup.elements.popupHeader.style.display="none"};Popup.elements={};Popup.onEnterCallback=null;Popup.setBody=function(a){Popup.elements.popupBody.innerText=a};Popup.setBodyHTML=function(a){Popup.elements.popupBody.innerHTML=a};Popup.clearBottom=function(){Popup.elements.popupBottom.innerHTML=""};
Popup.addButton=function(a,b,c){var d=document.createElement("div");d.setAttribute("id","__popup_button_"+(+new Date).toString("32"));d.className="button button-"+c;d.append(document.createTextNode(a));d.onclick=b;Popup.elements.popupBottom.append(d)};
Popup.create=function(){document.getElementById("overlay")||(Popup.elements.overlay=document.createElement("div"),Popup.elements.overlay.setAttribute("id","overlay"),Popup.elements.popup=document.createElement("div"),Popup.elements.popup.setAttribute("id","popup"),Popup.elements.popupContainer=document.createElement("div"),Popup.elements.popupContainer.setAttribute("id","popup-container"),Popup.elements.popupHeader=document.createElement("div"),Popup.elements.popupHeader.setAttribute("id","popup-header"),
Popup.elements.popupBody=document.createElement("div"),Popup.elements.popupBody.setAttribute("id","popup-body"),Popup.elements.popupBottom=document.createElement("div"),Popup.elements.popupBottom.setAttribute("id","popup-bottom"),Popup.elements.popupContainer.append(Popup.elements.popupHeader),Popup.elements.popupContainer.append(Popup.elements.popupBody),Popup.elements.popupContainer.append(Popup.elements.popupBottom),Popup.elements.popup.append(Popup.elements.popupContainer),Popup.elements.overlay.append(Popup.elements.popup),
document.body.append(Popup.elements.overlay))};Popup.visible=function(a){a?(Popup.elements.overlay.style.display="table",setTimeout(function(){Popup.elements.overlay.style.opacity="1"},200)):(Popup.elements.overlay.style.opacity="0",setTimeout(function(){Popup.elements.overlay.style.display="none"},200))};
Popup.show=function(a){return new Promise(function(b,c){Popup.create();Popup.clearBottom();Popup.setHeader(a.header);a.onEnterCallback&&"function"===typeof a.onEnterCallback&&(Popup.onEnterCallback=a.onEnterCallback);a.body&&Popup.setBody(a.body);a.bodyHTML&&Popup.setBodyHTML(a.bodyHTML);document.addEventListener("keydown",Popup.keydown);a.preventClose||Popup.addButton("Cerrar",Popup.hide,"secondary");a.buttons&&a.buttons.forEach(function(a){Popup.addButton(a.text,a.callback,a.type||"default")});
Popup.visible(!0);b()})};Popup.keydown=function(a){a=a||window.event;13==a.keyCode&&(Popup.onEnterCallback?(Popup.onEnterCallback(),Popup.onEnterCallback=null):Popup.hide())};Popup.hide=function(){document.removeEventListener("keydown",Popup.keydown);Popup.visible(!1)};var UI=UI||{};UI.scrollMenuListener=null;UI.currentSelected=[];UI.currentSubmenu=null;UI.imageLoaded=!1;UI.isImageLoaded=function(){return UI.imageLoaded};
UI.setImageLoaded=function(a){document.getElementById("canvas_info")&&(document.getElementById("canvas_info").style.display=a?"none":"");document.getElementById("image_main")&&(document.getElementById("image_main").style.display=a?"":"none");UI.imageLoaded=!!a};
UI.loadingHandler=function(){if(!document.getElementById("loading-bar")){var a=document.createElement("div");a.setAttribute("id","loading-bar");var b=document.createElement("div");b.setAttribute("id","loading-bar-container");var c=document.createElement("div");c.setAttribute("id","loading-bar-loader");b.append(c);a.append(b);document.body.append(a);return{load:function(){},set:function(a){100<a&&(a=100);0>a&&(a=0);setTimeout(function(){document.getElementById("loading-bar-loader").style.width=a+"%"},
0)},end:function(){this.set(100);setTimeout(function(){document.body.removeChild(a)},200)}}}};UI.closeSubmenu=function(a){document.getElementById("submenu_"+a).style.transform="translateY(-100%)";setTimeout(function(){document.getElementById("submenu_"+a).style.display="none"},200)};
UI.openSubmenu=function(a){var b=document.getElementById("submenu_"+a);a=b.children.length;for(var c=0,d=b.children[0];c<a;){if(-1<b.children[c].className.indexOf("selected")){d=b.children[c];break}c++}b.style.display="block";UI.selectAdjust(d);setTimeout(function(){b.style.transform="translateY(0%)"},200)};
UI.selectAdjust=function(a){if(a.getAttribute("data-submenu"))UI.currentSubmenu&&UI.currentSubmenu!==a.getAttribute("data-submenu")&&UI.closeSubmenu(UI.currentSubmenu),UI.currentSubmenu=a.getAttribute("data-submenu"),UI.openSubmenu(a.getAttribute("data-submenu"));else if(UI.currentSubmenu&&0>a.parentElement.className.indexOf("submenu")&&UI.closeSubmenu(UI.currentSubmenu),a.getAttribute("data-item")&&(current_adjust.paramName=a.getAttribute("data-item")),current_adjust.max=parseFloat(a.getAttribute("max")),
current_adjust.min=parseFloat(a.getAttribute("min")),current_adjust.callbacks=a.getAttribute("data-callback")||"",a=document.getElementById("cantidad"))a.innerHTML=Locale.get(current_adjust.paramName)+": "+Math.round(100*Params.get(current_adjust.paramName))/100};UI.dataActionClick=function(a){var b=a.target;console.log(a.target);b.getAttribute("data-action")&&(a=b.getAttribute("data-action"),window.Actions[a]())};
UI.rangeDblClick=function(a){a.stopPropagation();this.value=Params.getDefault(this.getAttribute("data-item"));Actions.setParam({paramName:this.getAttribute("data-item"),value:parseFloat(this.value),callbacks:this.getAttribute("data-callback"),save:!0});a.preventDefault()};UI.moveRange_timer={to:null,param:null};
UI.moveRange=function(a){var b=this;UI.moveRange_timer.to&&UI.moveRange_timer.to==this.getAttribute("data-item")&&clearTimeout(UI.moveRange_timer.to);UI.moveRange_timer.param=this.getAttribute("data-item");UI.moveRange_timer.to=setTimeout(function(){Actions.setParam({paramName:b.getAttribute("data-item"),value:parseFloat(b.value),callbacks:b.getAttribute("data-callback"),save:!0})},30)};
UI.scrollMenu=function(a){var b=a.target;if(!(0>a.target.className.indexOf("menu"))){var c=Math.round(__NUM_OF_MENU_ITEMS__*this.scrollLeft/document.body.offsetWidth);c+=__MENU_ITEMS_PADDING__;UI.scrollMenuListener&&clearTimeout(UI.scrollMenuListener);UI.scrollMenuListener=setTimeout(function(){UI.selectMenuItem(c,b)},150)}};UI.clickMenuContainer=function(a){this.parentElement.classList.contains("open")?this.parentElement.classList.remove("open"):this.parentElement.classList.add("open")};
UI.dropFile=function(a){a=a||window.event;a.preventDefault();a.stopPropagation();document.body.style.opacity=1;try{loadImageFromUrl(URL.createObjectURL(a.dataTransfer.files[0]))}catch(b){console.log(b),__ERROR("No se pudo cargar la imagen al arrastrarla, por favor, utilice el bot\u00f3n de abrir.")}};
var __SHADERS__={VERTEX:"attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() { vec2 dist = a_position / u_resolution; gl_Position = vec4( (dist * 2.0 - 1.0) * vec2(1, -1), 0, 1); v_texCoord = a_texCoord;}",FRAGMENT:"/** * David Iglesias. All rights reserved */ precision mediump float; uniform sampler2D u_image; uniform vec2 u_textureSize; uniform float u_kernel[25]; uniform float u_kernelWeight; uniform sampler2D u_lut; uniform float u_saturation; uniform float u_brightness; uniform float u_exposure; uniform float u_contrast; uniform float u_dehaze; uniform float u_atmosferic_light; uniform float u_masking; uniform vec3 u_temptint[3]; uniform float u_bAndW; uniform float u_hdr; varying vec2 v_texCoord; void main() { vec2 pixel_size = vec2(1.0, 1.0) / u_textureSize; vec3 center = texture2D(u_image, v_texCoord).rgb; vec4 colorSum = texture2D(u_image, v_texCoord + pixel_size * vec2(-2, -2)) * u_kernel[0] + texture2D(u_image, v_texCoord + pixel_size * vec2( -1, -2))* u_kernel[1] + texture2D(u_image, v_texCoord + pixel_size * vec2( 0, -2)) * u_kernel[2] + texture2D(u_image, v_texCoord + pixel_size * vec2( 1, -2)) * u_kernel[3] + texture2D(u_image, v_texCoord + pixel_size * vec2( 2, -2)) * u_kernel[4] + texture2D(u_image, v_texCoord + pixel_size * vec2( -2, -1))* u_kernel[5] + texture2D(u_image, v_texCoord + pixel_size * vec2(-1, -1)) * u_kernel[6] + texture2D(u_image, v_texCoord + pixel_size * vec2( 0, -1)) * u_kernel[7] + texture2D(u_image, v_texCoord + pixel_size * vec2( 1, -1)) * u_kernel[8] + texture2D(u_image, v_texCoord + pixel_size * vec2( 2, -1)) * u_kernel[9] + texture2D(u_image, v_texCoord + pixel_size * vec2( -2, 0)) * u_kernel[10] + texture2D(u_image, v_texCoord + pixel_size * vec2(-1, 0)) * u_kernel[11] + texture2D(u_image, v_texCoord + pixel_size * vec2( 0, 0)) * u_kernel[12] + texture2D(u_image, v_texCoord + pixel_size * vec2( 1, 0)) * u_kernel[13] + texture2D(u_image, v_texCoord + pixel_size * vec2( 2, 0)) * u_kernel[14] + texture2D(u_image, v_texCoord + pixel_size * vec2(-2, 1)) * u_kernel[15] + texture2D(u_image, v_texCoord + pixel_size * vec2(-1, 1)) * u_kernel[16] + texture2D(u_image, v_texCoord + pixel_size * vec2( 0, 1)) * u_kernel[17] + texture2D(u_image, v_texCoord + pixel_size * vec2( 1, 1)) * u_kernel[18] + texture2D(u_image, v_texCoord + pixel_size * vec2( 2, 1)) * u_kernel[19] + texture2D(u_image, v_texCoord + pixel_size * vec2(-2, 2)) * u_kernel[20] + texture2D(u_image, v_texCoord + pixel_size * vec2(-1, 2)) * u_kernel[21] + texture2D(u_image, v_texCoord + pixel_size * vec2( 0, 2)) * u_kernel[22] + texture2D(u_image, v_texCoord + pixel_size * vec2( 1, 2)) * u_kernel[23] + texture2D(u_image, v_texCoord + pixel_size * vec2( 2, 2)) * u_kernel[24]; vec3 rgb_pix = mix(center, (colorSum.rgb / u_kernelWeight), u_masking); float _max = max(rgb_pix.r, max(rgb_pix.g, rgb_pix.b)); float _min = min(rgb_pix.r, min(rgb_pix.g, rgb_pix.b)); vec2 sv_pixel = vec2(1.0 - _min / _max, _max); sv_pixel.y = clamp(texture2D(u_lut, vec2(sv_pixel.y, 0.0)).a, 0.0, 1.0); if (u_saturation != 0.0) { sv_pixel.x *= (1.0 + u_saturation); } sv_pixel.x = clamp(sv_pixel.x, 0.0, 1.0); if (u_brightness != 0.0) { sv_pixel.y = pow(sv_pixel.y, 1.0 - u_brightness * 0.6); } if (u_hdr != 0.0) { sv_pixel.y = mix(sv_pixel.y, clamp(1.0 - pow(1.0 - pow(sv_pixel.y, 0.3), 0.42), 0.0, 1.0), u_hdr); } sv_pixel = clamp(sv_pixel, 0.0, 1.0); if (sv_pixel.x > 0.0) { float k = - sv_pixel.x / (1.0 - _min / _max); rgb_pix = (_max - rgb_pix) * k + _max; rgb_pix *= sv_pixel.y / _max; } else { rgb_pix.r = rgb_pix.g = rgb_pix.b = sv_pixel.y; } if (u_dehaze != 0.0) { float t = 1.0 / 25.0; vec4 center = texture2D(u_image, v_texCoord); vec2 pixel_size = vec2(1.0, 1.0) / u_textureSize; float dark = 1.0; const int radius = 1; for (int ii = -radius; ii <= radius; ii++ ) { for(int jj = -radius; jj <= radius; jj++) { vec4 pix = texture2D(u_image, v_texCoord + pixel_size * vec2( ii, jj)); float _min = min(pix.r, min(pix.g, pix.b)); if (dark > _min) { dark = _min; } } } float darkPix = min(center.r, min(center.g, center.b)); float diff = abs(darkPix - dark); float mask = pow(diff, 3.0); dark = mix(darkPix, dark, mask); float mm = max(1.0 - dark, 0.2); rgb_pix = mix(rgb_pix, ((rgb_pix - u_atmosferic_light) / mm + u_atmosferic_light), u_dehaze); } rgb_pix += u_exposure; rgb_pix = clamp(rgb_pix, 0.0, 1.0); float contrast = u_contrast + 1.0; rgb_pix = contrast * (rgb_pix - 0.5) + 0.5; rgb_pix *= u_temptint[0]; float mono = dot(rgb_pix, vec3(0.2126, 0.7152, 0.0722)); rgb_pix += mix(u_temptint[2], u_temptint[1], mono); if (u_bAndW != 0.0) { rgb_pix = mix(rgb_pix, vec3(mono, mono, mono), u_bAndW); } gl_FragColor = vec4(rgb_pix, 1.0); }"},
Locale=Locale||{};
Locale.dict={es:{exposure:"Exposici\u00f3n",contrast:"Contraste",brightness:"Brillo",whites:"Claros",highlights:"Luces",shadows:"Sombras",blacks:"Oscuros",temperature:"Temperatura",tint:"Matiz",saturation:"Saturaci\u00f3n",vibrance:"Vibrancia",bAndW:"Blanco y negro",sharpen:"Detalles",sharpen_radius:"Radio de detalle",masking:"M\u00e1scara",radiance:"Radiancia",dehaze:"Niebla",atmosferic_light:"Luz atmosf\u00e9rica",hdr:"Alto rango din\u00e1mico",lightColor:"Color",lightFill:"Cantidad",lightSat:"Cantidad",
darkColor:"Color",darkFill:"Cantidad",darkSat:"Cantidad",image_no_loaded:"No hay ninguna imagen cargada. Para editar, cargue una imagen.",image_save_title:"\u00bfDesea guardar la imagen?",image_save_text:"Nombre de la imagen (Resoluci\u00f3n m\u00e1xima: 10Mpx) :"}};Locale.current="es";Locale.get=function(a){return Locale.dict[Locale.current][a]?Locale.dict[Locale.current][a]:a};var Params=Params||{};
Params.params={hdr:0,exposure:0,temperature:0,tint:0,brightness:0,saturation:0,contrast:0,sharpen:0,masking:.5,sharpen_radius:1,radiance:0,highlights:0,shadows:0,whites:0,blacks:0,dehaze:0,bAndW:0,atmosferic_light:.7,lightFill:0,lightColor:0,lightSat:1,darkFill:0,darkColor:0,darkSat:1};Params.default=function(a){var b={};Object.keys(a).forEach(function(c){b[c]=a[c]});return b}(Params.params);Params.get=function(a){return Params.params[a]};
Params.reset=function(a){Object.keys(Params.params).forEach(function(a){Params.params[a]=Params.default[a]})};Params.set=function(a,b){Params.params[a]=parseFloat(b)};Params.getDefault=function(a){return Params.default[a]};window.addEventListener("onload",function(){if("serviceWorker"in navigator)try{navigator.serviceWorker.register("/serviceWorker.js"),console.log("NONE")}catch(a){}});
var __NUM_OF_MENU_ITEMS__=5,__MENU_ITEMS_PADDING__=Math.floor((__NUM_OF_MENU_ITEMS__-1)/2),CURRENT_IMAGE_TRANSFORMATIONS={x:0,y:0,scale:1,originX:null,originY:null,deltaX:0,deltaY:0},current_adjust={paramName:"exposure",max:1,min:-1,callbacks:""};function isMobile(){return/mobile|android|iphone|ipad|ipod|kindle|symbian/i.test(navigator.userAgent||navigator.vendor||window.opera)}window.onerror=function(a,b,c){__ERROR(a+" en la url: "+b+", en la L\u00ednea:"+c)};var touch_events=touch_events||{};
touch_events.adjusts=[];touch_events.currentAdjust=null;touch_events.startPoints={x:null,y:null,time:0};touch_events.endPoints={x:null,y:null,time:0};touch_events.touch=null;touch_events.start=function(a){current_adjust&&(touch_events.startPoints.x=a.touches[0].pageX/document.body.offsetWidth,touch_events.startPoints.y=a.touches[0].pageY/document.body.offsetHeight,touch_events.startPoints.time=+new Date)};var DIRECTION={TOP:0,RIGHT:1,LEFT:2,BOTTOM:3};
touch_events.move=function(a){touch_events.endPoints.x=a.touches[0].pageX/document.body.offsetWidth;touch_events.endPoints.y=a.touches[0].pageY/document.body.offsetHeight;touch_events.endPoints.time=+new Date;var b=touch_events.endPoints.x-touch_events.startPoints.x,c=touch_events.endPoints.y-touch_events.startPoints.y,d=a.touches[0].pageY,f=document.body.offsetHeight-d;1==a.touches.length&&(1===CURRENT_IMAGE_TRANSFORMATIONS.scale||a.target!==imageElm)&&100<f&&80<d?current_adjust&&(a=1.25*(a.touches[0].pageX/
document.body.offsetWidth-.1),0>a&&(a=0),1<a&&(a=1),b=current_adjust.min,Actions.setParam({paramName:current_adjust.paramName,value:parseFloat((current_adjust.max-b)*a+b),callbacks:current_adjust.callbacks,save:!0})):a.target==imageElm&&(1==a.touches.length&&(console.log("Moviendo imagen"),c*=document.body.offsetHeight,CURRENT_IMAGE_TRANSFORMATIONS.x=CURRENT_IMAGE_TRANSFORMATIONS.deltaX+b*document.body.offsetWidth,CURRENT_IMAGE_TRANSFORMATIONS.y=CURRENT_IMAGE_TRANSFORMATIONS.deltaY+c,CURRENT_IMAGE_TRANSFORMATIONS.x>
CURRENT_IMAGE_TRANSFORMATIONS.originX&&(CURRENT_IMAGE_TRANSFORMATIONS.x=CURRENT_IMAGE_TRANSFORMATIONS.originX),CURRENT_IMAGE_TRANSFORMATIONS.y>CURRENT_IMAGE_TRANSFORMATIONS.originY&&(CURRENT_IMAGE_TRANSFORMATIONS.y=CURRENT_IMAGE_TRANSFORMATIONS.originY),UI.updateImageTransformation()),2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-a.touches[1].pageX),a/=document.body.offsetWidth,a=.5+2*a,1>a&&(a=1),a=Math.round(100*a)/100,document.getElementById("cantidad").innerText="Zoom: "+a,CURRENT_IMAGE_TRANSFORMATIONS.scale=
a,UI.updateImageTransformation()))};touch_events.end=function(a){CURRENT_IMAGE_TRANSFORMATIONS.deltaX=CURRENT_IMAGE_TRANSFORMATIONS.x;CURRENT_IMAGE_TRANSFORMATIONS.deltaY=CURRENT_IMAGE_TRANSFORMATIONS.y};touch_events.cancel=function(a){};touch_events.leave=function(a){};window.RAF=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(a){setTimeout(a,30)};
window.addEventListener("load",function(a){var b=document.getElementsByClassName("data-action");for(a=b.length;a--;)b[a].addEventListener("click",UI.dataActionClick);b=document.getElementsByClassName("menu_item");for(a=b.length;a--;)b[a].addEventListener("click",UI.clickMenuItem);document.getElementById("image-open").addEventListener("click",function(){document.getElementById("image_data").click()});document.getElementById("image-save").addEventListener("click",function(){window.Actions.download()});
document.getElementById("slider_adjust_range").addEventListener("input",UI.sliderChange);history.pushState(null,document.title,location.href);window.addEventListener("popstate",function(a){UI.isSliderShown()&&(history.pushState(null,document.title,location.href),UI.hideSlider())});document.getElementById("canvas").addEventListener("click",function(a){UI.isSliderShown()&&UI.hideSlider()});__BOOT__()});UI=UI||{};UI.currentSelected=[];UI.currentAdjust=null;UI.currentSubmenu=null;
UI.updateImageTransformation=function(){imageElm.style.transformOrigin=" "+CURRENT_IMAGE_TRANSFORMATIONS.originX+"px "+CURRENT_IMAGE_TRANSFORMATIONS.originY+"px";imageElm.style.transform="translate("+CURRENT_IMAGE_TRANSFORMATIONS.x+"px, "+CURRENT_IMAGE_TRANSFORMATIONS.y+"px) scale("+CURRENT_IMAGE_TRANSFORMATIONS.scale+")"};
UI.closeSubmenu=function(a){document.getElementById("submenu_"+a).style.transform="translateY(600%)";setTimeout(function(){document.getElementById("submenu_"+a).style.display="none"},200)};UI.openSubmenu=function(a){var b=document.getElementById("submenu_"+a);a=b.children.length;for(var c=0;c<a&&!(-1<b.children[c].className.indexOf("selected"));)c++;b.style.display="block";setTimeout(function(){b.style.transform="translateY(0%)"},200)};
UI.selectAdjust=function(a){if(a.getAttribute("data-submenu"))UI.currentSubmenu&&UI.currentSubmenu!==a.getAttribute("data-submenu")&&UI.closeSubmenu(UI.currentSubmenu),UI.currentSubmenu=a.getAttribute("data-submenu"),UI.openSubmenu(a.getAttribute("data-submenu"));else{UI.currentSubmenu&&0>a.parentElement.className.indexOf("submenu")&&UI.closeSubmenu(UI.currentSubmenu);a.getAttribute("data-item")&&(current_adjust.paramName=a.getAttribute("data-item"));current_adjust.max=parseFloat(a.getAttribute("max"));
current_adjust.min=parseFloat(a.getAttribute("min"));current_adjust.callbacks=a.getAttribute("data-callback")||"";a=document.getElementById("cantidad");var b=Math.round(100*Editor.getParamValue(current_adjust.paramName))/100;a&&(a.innerHTML=Locale.get(current_adjust.paramName)+": "+b);UI.showSlider()}};UI.dataActionClick=function(a){var b=a.target;console.log(a.target);if(b.getAttribute("data-action"))window.Actions[b.getAttribute("data-action")]()};
UI.selectMenuItem=function(a,b){b||(b=document.getElementById("menu"));var c=b.getAttribute("id");UI.currentSelected[c]||(UI.currentSelected[c]=0);UI.currentSelected[b.getAttribute("id")]!==a&&(b.children[UI.currentSelected[c]].classList.remove("selected"),b.children[a].classList.add("selected"),UI.currentSelected[b.getAttribute("id")]=a);UI.selectAdjust(b.children[a])};
UI.clickMenuItem=function(a){console.log(a.target);if(this===a.target.parentElement){var b=a.target.parentElement;a=a.target.parentElement.parentElement;if(a.classList.contains("menu"))for(var c=a.children.length,d=0;d<c;){if(a.children[d]===b){console.log(d);UI.selectMenuItem(d,a);break}d++}}};UI.sliderChangeTO={to:null,param:null};
UI.sliderChange=function(a){a=current_adjust.min;var b=(current_adjust.max-a)*this.value+a;b=Math.round(100*b)/100;if(a=document.getElementById("cantidad"))a.innerHTML=Locale.get(current_adjust.paramName)+": "+parseInt(200*(this.value-.5))/100;UI.sliderChangeTO.param==current_adjust.paramName?clearTimeout(UI.sliderChangeTO.to):UI.sliderChangeTO.param=current_adjust.paramName;UI.sliderChangeTO.to=setTimeout(function(){Actions.setParam({paramName:current_adjust.paramName,value:parseFloat(b),callbacks:current_adjust.callbacks,
save:!0})},10)};
UI.showSlider=function(){var a={temperature:"temp",tint:"tint",saturation:"sat",vibrance:"sat",bAndW:"baw",lightFill:"amount",lightColor:"hsl",lightSat:"sat",darkFill:"amount",darkColor:"hsl",darkSat:"sat"}[current_adjust.paramName]||"";document.getElementById("slider_adjust_range").className=a;a=(Editor.getParamValue(current_adjust.paramName)||0)-current_adjust.min;a/=current_adjust.max-current_adjust.min;document.getElementById("slider_adjust_range").value=a;document.getElementById("slider_adjust_info").innerText=Locale.get(current_adjust.paramName);
document.getElementById("slider_adjust").style.display="block"};UI.hideSlider=function(){document.getElementById("slider_adjust").style.display="none"};UI.isSliderShown=function(){return"none"!=document.getElementById("slider_adjust").style.display};
