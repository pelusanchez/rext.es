var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in c||(c[f]={});c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof f?a:new f(function(b,d){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var d=a[b];a[b]=null;try{d()}catch(n){this.asyncThrow_(n)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var f=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(q){b.reject(q)}};f.prototype.createResolveAndReject_=function(){function a(a){return function(c){d||(d=!0,a.call(b,c))}}var b=this,d=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};f.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof f)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};f.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(q){this.reject_(q);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};f.prototype.reject_=function(a){this.settle_(2,a)};f.prototype.fulfill_=function(a){this.settle_(1,a)};f.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};f.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)h.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var h=new b;f.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};f.prototype.settleSameAsThenable_=function(a,b){var d=this.createResolveAndReject_();try{a.call(b,d.resolve,d.reject)}catch(n){d.reject(n)}};f.prototype.then=function(a,b){function d(a,b){return"function"==typeof a?function(b){try{c(a(b))}catch(g){h(g)}}:b}var c,h,l=new f(function(a,b){c=a;h=b});this.callWhenSettled_(d(a,c),d(b,h));return l};
f.prototype.catch=function(a){return this.then(void 0,a)};f.prototype.callWhenSettled_=function(a,b){function d(){switch(c.state_){case 1:a(c.result_);break;case 2:b(c.result_);break;default:throw Error("Unexpected state: "+c.state_);}}var c=this;null==this.onSettledCallbacks_?h.asyncExecute(d):this.onSettledCallbacks_.push(d)};f.resolve=c;f.reject=function(a){return new f(function(b,d){d(a)})};f.race=function(a){return new f(function(b,d){for(var f=$jscomp.makeIterator(a),h=f.next();!h.done;h=f.next())c(h.value).callWhenSettled_(b,
d)})};f.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new f(function(a,f){function h(b){return function(d){k[b]=d;l--;0==l&&a(k)}}var k=[],l=0;do k.push(void 0),l++,c(d.value).callWhenSettled_(h(k.length-1),f),d=b.next();while(!d.done)})};return f},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var f=d.value}catch(h){return this.context_.yieldAllIterator_=null,this.context_.throw_(h),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,f);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function c(b){return a.throw(b)}return new Promise(function(d,f){function h(a){a.done?d(a.value):Promise.resolve(a.value).then(b,c).then(h,f)}h(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
(function(a){function b(a){var b=a[2]*a[1];var d=b*(1-Math.abs(a[0]/60%2-1));var c=a[2]-b;if(180>a[0])if(60>a[0]){var e=a[2];var p=d+c;a=c}else 120>a[0]?(e=d+c,p=a[2],a=c):(e=c,p=a[2],a=d+c);else 240>a[0]?(e=c,p=d+c,a=a[2]):300>a[0]?(e=d+c,p=c,a=b+c):(e=b+c,p=c,a=d+c);return[0>e?0:1<e?1:e,0>p?0:1<p?1:p,0>a?0:1<a?1:a]}function c(a){Popup.show({header:"Se ha producido un error",body:a})}function d(a,b,d){b=a.createShader(b);a.shaderSource(b,d);a.compileShader(b);if(a.getShaderParameter(b,a.COMPILE_STATUS))return b;
console.log(a.getShaderInfoLog(b));a.deleteShader(b)}function f(a,b,d){var p=a.createProgram();a.attachShader(p,b);a.attachShader(p,d);a.linkProgram(p);if(a.getProgramParameter(p,a.LINK_STATUS))return p;console.log(a.getProgramInfoLog(p));a.deleteProgram(p);c("createProgram Error")}function h(a){var b=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);return b}function l(a){return a.reduce(function(a,b){return a+b})}function m(p,x,D){function A(){e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,256,1,0,e.ALPHA,e.UNSIGNED_BYTE,new Uint8Array(v));e.useProgram(g);e.enableVertexAttribArray(m);e.bindBuffer(e.ARRAY_BUFFER,r);e.vertexAttribPointer(m,2,e.FLOAT,!1,0,0);e.enableVertexAttribArray(n);e.bindBuffer(e.ARRAY_BUFFER,C);e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0);e.uniform2f(F,
w,y);e.uniform2f(H,w,y);e.uniform1f(I,Params.get("brightness"));e.uniform1f(J,Params.get("exposure"));e.uniform1f(K,Params.get("contrast"));e.uniform1f(L,Params.get("saturation"));e.uniform1f(M,Params.get("masking"));e.uniform1f(N,Params.get("dehaze"));e.uniform1f(O,Params.get("atmosferic_light"));e.uniform3fv(P,t.concat(b([360*Params.get("lightColor"),Params.get("lightSat"),Params.get("lightFill")])).concat(b([360*Params.get("darkColor"),Params.get("darkSat"),Params.get("darkFill")])));e.uniform1f(Q,
Params.get("bAndW"));e.uniform1f(T,Params.get("hdr"));e.uniform1i(U,0);e.uniform1i(V,1);e.uniform1fv(aa,u);e.uniform1f(ba,l(u));e.drawArrays(e.TRIANGLES,0,6)}var e=x||a.__gl;x=d(e,e.VERTEX_SHADER,__SHADERS__.VERTEX);var k=d(e,e.FRAGMENT_SHADER,__SHADERS__.FRAGMENT);try{var g=f(e,x,k)}catch(z){return c(z)}var m=e.getAttribLocation(g,"a_position"),n=e.getAttribLocation(g,"a_texCoord"),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);var w=p.width,y=p.height;e.canvas.width=w;e.canvas.height=y;console.log("[IMAGE] width = "+
w+", height = "+y);q(e,0,0,w,y);var C=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,C);e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW);e.activeTexture(e.TEXTURE0);h(e);try{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,p)}catch(z){return c(z)}var U=e.getUniformLocation(g,"u_image"),F=e.getUniformLocation(g,"u_resolution"),H=e.getUniformLocation(g,"u_textureSize"),aa=e.getUniformLocation(g,"u_kernel[0]"),ba=e.getUniformLocation(g,"u_kernelWeight"),J=
e.getUniformLocation(g,"u_exposure"),I=e.getUniformLocation(g,"u_brightness"),K=e.getUniformLocation(g,"u_contrast"),L=e.getUniformLocation(g,"u_saturation"),M=e.getUniformLocation(g,"u_masking"),N=e.getUniformLocation(g,"u_dehaze"),O=e.getUniformLocation(g,"u_atmosferic_light"),P=e.getUniformLocation(g,"u_temptint[0]"),Q=e.getUniformLocation(g,"u_bAndW"),T=e.getUniformLocation(g,"u_hdr"),V=e.getUniformLocation(g,"u_lut");e.activeTexture(e.TEXTURE1);h(e);a.updatePhoto=function(){return A()};e.viewport(0,
0,w,y);e.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT);D||A()}function q(a,b,d,c,e){c=b+c;e=d+e;a.bufferData(a.ARRAY_BUFFER,new Float32Array([b,d,c,d,b,e,b,e,c,d,c,e]),a.STATIC_DRAW)}function n(b){var d=UI.loadingHandler();k=new Image;k.src=b;k.onload=function(){if(1E7<k.width*k.height){var a=k.height/k.width;k.height=parseInt(Math.sqrt(1E7*a));k.width=parseInt(k.height/a)}};var f=new Image;f.onerror=function(){d.end();c("Error al cargar la imagen.")};f.onload=function(){d.set(30);try{var b=document.createElement("canvas");
if(2E6<f.height*f.width){var e=Math.sqrt(2E6*f.height/f.width);b.width=f.width/f.height*e;b.height=e}else b.width=f.width,b.height=f.height;d.set(40);var p=b.getContext("2d");p.imageSmoothingEnabled=1;p.drawImage(f,0,0,b.width,b.height);d.set(60);var x=new Image;x.src=b.toDataURL("image/png");d.set(80);x.onload=function(){d.end();UI.setImageLoaded(!0);m(x,a.gl)}}catch(E){c(E),d.end()}};f.src=b;d.set(20)}a.requestAnimationFrame=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||
a.msRequestAnimationFrame||function(a){setTimeout(a,20)};var k=null,t=[1,1,1],u=[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],r=r||{};r.kernel_update=function(){var a=-Params.get("sharpen"),b=Params.get("sharpen_radius"),d=Params.get("radiance"),c=Params.get("hdr");0!=d&&(a-=.5*d,b+=.5*d);0!=c&&(a-=.5*c,b+=.5*c);d=a*Math.exp(-Math.pow(1/b,2));c=a*Math.exp(-Math.pow(1.41/b,2));var e=a*Math.exp(-Math.pow(2/b,2)),f=a*Math.exp(-Math.pow(2.24/b,2));b=a*Math.exp(-Math.pow(2.83/b,2));var h=1;0>a&&
(h+=4*Math.abs(b)+8*Math.abs(f)+4*Math.abs(e)+4*Math.abs(c)+4*Math.abs(d));u=[b,f,e,f,b,f,c,d,c,f,e,d,h,d,e,f,c,d,c,f,b,f,e,f,b]};r.updateTemptint=function(){var a=Params.get("temperature"),b=Params.get("tint");0>a?(R=1,a=[[.6167426069865002,.017657981710823077],[.5838624982041293,.06447754787874993],[.5666570157784903,.1010769359975838],[.5600215017846518,.13012054359808795],[.5603460901328465,.15370282338343416],[.5651414015638195,.1734071109259789],[.5727157905223393,.19040417876076665],[.5819305919306469,
.20554787970182647],[.5920253173976543,.219454396860673],[.6024964973113273,.23256361077001078],[.613014923688415,.2451851574423344],[.6233694681448863,.2575325541865392],[.633428991849502,.2697484189519574],[.6431164873163056,.2819231700046263],[.6523914777767198,.29410898225476145],[.6612380004437802,.30633028466830314],[.6696563786680246,.31859171532935343],[.6776575761390952,.330884185957384],[.6852593188363603,.34318952105568623],[.6924834326806721,.3554840067292358],[.6993540206164168,.36774109382812364],
[.705896221219359,.37993343721079975],[.712135371070854,.3920344089104195],[.7180964477199883,.4040191918024166],[.7238037074478182,.41586553788423575],[.7292804578150028,.42755425869079605],[.7345489228275083,.43906950280216533],[.7396301709912545,.4503988656030025],[.7445440852278651,.4615333686006381],[.7493093597375261,.47246733915721345],[.7539435132044948,.4831982160881075],[.7584629107855697,.4937263019887011],[.7628827894765442,.5040544792219176],[.7672172829757861,.5141879031216875],[.7756812566990368,
.5339005596070674],[.7756812566990368,.5339005596070674],[.7798336535847834,.5434985836882681],[.7839465092903851,.552938802301879],[.7880286368234596,.5622329533372938],[.7920877696863722,.5713931712543325],[.796130534601134,.5804317041849897],[.8001624136045166,.5893606423074715],[.8041876951180534,.5981916567442426],[.8082094136732589,.6069357478075997],[.8122292780585781,.6156030011340633],[.8162475877574743,.624202350096731],[.8202631376804659,.6327413428542148],[.8242731113661302,.6412259124772712],
[.8282729630469863,.6496601487868902],[.8322562892583072,.6580460708395705],[.8362146910181553,.6663833994084263],[.8401376280395388,.6746693293369075],[.8440122669563406,.6828983022904387],[.8478233261635671,.691061781205187],[.8515529205921868,.6991480286361483],[.8578515274860328,.7143328511178657],[.8630349166004683,.7236145588845],[.8630349166004683,.7236145588845],[.8678866519883774,.7326305266929798],[.8724265417351438,.7413920824039555],[.8766746938112879,.7499106260961086],[.8806514255414362,
.7581975699581189],[.8843771730729832,.7662642858505886],[.8878724008449614,.7741220599147951],[.8911575110568668,.7817820536219475],[.8942527531374216,.7892552706795768],[.8971781332133792,.7965525292390034],[.9025975721615955,.8106613818669473],[.9051296119968262,.8174934982533621],[.9051296119968262,.8174934982533621],[.9075675706910422,.8241906743465228],[.9099288798932852,.8307625342003426],[.912230184763394,.8372184337382709],[.914487253441016,.8435674571884941],[.9167148865142485,.8498184155292972],
[.9189268264883301,.8559798466723794],[.9211356672547586,.862060017138353],[.9233527635598611,.8680669250033681],[.9278504028585166,.8798916280267886],[.9301466448383797,.8857241176152066],[.9324823592671754,.8915127453709542],[.9348613471976668,.8972642431099969],[.9348613471976668,.8972642431099969],[.9372856273504615,.9029851088748369],[.9397553455825536,.9086816143048344],[.9422686843563701,.9143598121965675],[.9448217722084058,.9200255441824128],[.947408593218177,.925684448465339],[.9500208964767429,
.931341967556689],[.9552772279767501,.9426736878435626],[.9578927646784257,.9483578644262163],[.9604766194871308,.954060621455171],[.9630080085847714,.9597865363484674],[.965463369977889,.9655400352277332],[.965463369977889,.9655400352277332],[.9678162729662736,.9713253997462401],[.9700373276119754,.9771467737131783],[.9720940942080452,.9830081695063213],[.9739509927471266,.9889134742677088],[.97556921239073,.9948664558790756],[.9782396416593983,1]][parseInt(100*(a+1))],G=a[0],B=a[1]):(R=.0438785/
Math.pow(a+.150127,1.23675)+.543991,G=.0305003/Math.pow(a+.163976,1.23965)+.69136,B=1);-1==b&&(b=-.99);G+=b;b=1/(.2126*R+.7152*G+.0722*B);t=[R*b,G*b,B*b]};var v=function(){for(var a=[],b=0;256>b;b++)a[b]=b;return a}();r.generateLightning=function(){var a=Params.get("blacks"),b=Params.get("shadows"),d=Params.get("highlights"),c=Params.get("whites"),e=Params.get("radiance");a=getCuadraticFunction(a,b+.33,d+.66,c+1,0,.33,.66,1);if(0!=e)var f=getCuadraticFunction(0,.33-.11*e,.66+.11*e,1,0,.33,.66,1);
for(e=0;256>e;e++)b=e/256,1<b&&(b=1),0>b&&(b=0),1<b&&(b=1),0>b&&(b=0),f&&(b=f(b)),b=a(b),1<b&&(b=1),0>b&&(b=0),v[e]=255*b};var g=g||{};g.reset=function(){if(confirm("Desea reiniciar los ajustes?")){Params.reset();for(var a=document.getElementsByClassName("range"),b=a.length;b--;){var d=a[b].getAttribute("data");a[b].value=Params.get(d);a[b].getAttribute("data-callback")&&g.callCallbacks(a[b].getAttribute("data-callback"))}updatePhoto()}};g.downloadSecondStep=function(){var b=document.getElementById("image-name").value;
Popup.hide();b||(b="image");b+=".jpg";var d=UI.loadingHandler(),c=document.getElementById("image_main");c.width=k.width;c.height=k.height;d.set(10);m(k,a.__gl,!0);d.set(40);setTimeout(function(){d.set(70);updatePhoto();c.toBlob(function(a){d.set(90);a=URL.createObjectURL(a);var c=document.createElement("a");c.href=a;c.download=b;document.body.append(c);c.click();document.body.removeChild(c);URL.revokeObjectURL(a);a=null;setTimeout(function(){d.end();m(k)},2E3)},"image/jpeg",.95)},2E3)};g.download=
function(){Popup.show({header:Locale.get("image_save_title"),bodyHTML:Locale.get("image_save_text")+'<br><input type="text" id="image-name" placeholder="Nombre de la imagen">',onEnterCallback:g.downloadSecondStep,buttons:[{text:"Aceptar",callback:g.downloadSecondStep}]}).then(function(){document.getElementById("image-name").focus()})};g.callCallbacks=function(a){a.split(",").forEach(function(a){r[a]()})};g.setParam=function(a){if(!UI.isImageLoaded())return c(Locale.get("image_no_loaded"));var b=document.getElementById("cantidad");
b&&(b.innerHTML=Locale.get(a.paramName)+": "+Math.round(100*a.value)/100);a.save&&g.history.push({paramName:a.paramName,value:Params.get(a.paramName),callbacks:a.callbacks});Params.set(a.paramName,a.value);a.callbacks&&g.callCallbacks(a.callbacks);updatePhoto()};g.timeOutSliderInfo=null;g.sliderCallback=function(a){g.setParam({paramName:this.getAttribute("data"),value:this.value,callbacks:this.getAttribute("data-callback"),save:!0})};g.history={hist:[],currCur:0,push:function(a){a.updateTime=+new Date;
0<this.currCur&&this.hist[this.currCur-1].paramName==a.paramName&&1E3>+new Date-this.hist[this.currCur-1].updateTime?this.hist[this.currCur-1]=a:(50<this.hist.length&&this.hist.splice(0,hist.length-50),a.save=!1,this.currCur=this.hist.push(a))},undo:function(){if(!(1>this.currCur)){var a=this.hist[--this.currCur];g.setParam(a)}},redo:function(){if(!(this.currCur>=this.hist.length)){var a=this.hist[++this.currCur];g.setParam(a)}}};window.__BOOT__=function(){imageElm=document.getElementById("image_main");
a.__gl=imageElm.getContext("webgl")||imageElm.getContext("experimental-webgl");a.__gl||alert("Error: No webgl detected");document.getElementById("image_data").addEventListener("change",function(b){b=b||a.event;new FileReader;b.target.files[0]&&n(URL.createObjectURL(b.target.files[0]))});for(var b=document.getElementsByClassName("slider"),d=b.length;d--;)b[d].addEventListener("input",g.sliderCallback)};window.__ERROR=c;window.Actions=g;window.isMobile=function(){return/mobile|android|iphone|ipad|ipod|kindle|symbian/i.test(navigator.userAgent||
navigator.vendor||a.opera)};var w=w||{};w.getParamValue=function(a){return Params.get(a)};window.Editor=w})(window);function res_treatment(a){for(var b=a.length,c=0;c<b;c++)a[c]=Math.round(1E3*a[c])/1E3;return a}
top.getCuadraticFunction=function(a,b,c,d,f,h,l,m){f=void 0===f?0:f;h=void 0===h?.33:h;l=void 0===l?.66:l;m=void 0===m?1:m;var q=Math.pow(f,2),n=Math.pow(h,2),k=Math.pow(l,2),t=Math.pow(m,2),u=res_treatment(preSolve4([q*f,n*h,k*l,t*m],[q,n,k,t],[f,h,l,m],[a,b,c,d]));return function(a){var b=u[3],d=a;b+=u[2]*d;d*=a;b+=u[1]*d;return b+=u[0]*d*a}};
function preSolve4(a,b,c,d){var f=c[2]-c[3],h=a[2]-a[3],l=b[2]-b[3],m=d[2]-d[3],q=b[2]*c[3]-c[2]*b[3],n=a[2]*c[3]-c[2]*a[3],k=a[2]*b[3]-b[2]*a[3],t=d[2]*c[3]-c[2]*d[3],u=d[2]*b[3]-b[2]*d[3],r=a[2]*d[3]-d[2]*a[3],v=b[2]*d[3]-d[2]*b[3],g=c[2]*d[3]-d[2]*c[3];W=b[1]*f-c[1]*l+q;X=a[1]*f-c[1]*h+n;Y=a[1]*l-b[1]*h+k;Z=a[1]*q-b[1]*n+c[1]*k;_S=a[0]*W-b[0]*X+c[0]*Y-Z;S=b[1]*f-c[1]*l+q;X=d[1]*f-c[1]*m+t;Y=d[1]*l-b[1]*m+u;Z=d[1]*q-b[1]*t+c[1]*u;_W=d[0]*S-b[0]*X+c[0]*Y-Z;W=d[1]*f-c[1]*m+t;S=a[1]*f-c[1]*h+n;Y=a[1]*
m-d[1]*h+r;Z=a[1]*t-d[1]*n+c[1]*r;_X=a[0]*W-d[0]*S+c[0]*Y-Z;W=b[1]*m-d[1]*l+v;X=a[1]*m-d[1]*h+r;S=a[1]*l-b[1]*h+k;Z=a[1]*v-b[1]*r+d[1]*k;_Y=a[0]*W-b[0]*X+d[0]*S-Z;W=b[1]*g-c[1]*v+d[1]*q;X=a[1]*g-c[1]*r+d[1]*n;Y=a[1]*v-b[1]*r+d[1]*k;S=a[1]*q-b[1]*n+c[1]*k;_Z=a[0]*W-b[0]*X+c[0]*Y-d[0]*S;return[_W/_S,_X/_S,_Y/_S,_Z/_S]}
function solve4(a,b,c,d,f){var h=c[2]*d[3]-d[2]*c[3],l=b[2]*d[3]-d[2]*b[3],m=b[2]*c[3]-c[2]*b[3],q=a[2]*d[3]-d[2]*a[3],n=a[2]*c[3]-c[2]*a[3],k=a[2]*b[3]-b[2]*a[3],t=f[2]*d[3]-d[2]*f[3],u=f[2]*c[3]-c[2]*f[3],r=f[2]*b[3]-b[2]*f[3],v=a[2]*f[3]-f[2]*a[3],g=b[2]*f[3]-f[2]*b[3],w=c[2]*f[3]-f[2]*c[3];W=b[1]*h-c[1]*l+d[1]*m;X=a[1]*h-c[1]*q+d[1]*n;Y=a[1]*l-b[1]*q+d[1]*k;Z=a[1]*m-b[1]*n+c[1]*k;_S=a[0]*W-b[0]*X+c[0]*Y-d[0]*Z;S=b[1]*h-c[1]*l+d[1]*m;X=f[1]*h-c[1]*t+d[1]*u;Y=f[1]*l-b[1]*t+d[1]*r;Z=f[1]*m-b[1]*
u+c[1]*r;_W=f[0]*S-b[0]*X+c[0]*Y-d[0]*Z;W=f[1]*h-c[1]*t+d[1]*u;S=a[1]*h-c[1]*q+d[1]*n;Y=a[1]*t-f[1]*q+d[1]*v;Z=a[1]*u-f[1]*n+c[1]*v;_X=a[0]*W-f[0]*S+c[0]*Y-d[0]*Z;W=b[1]*t-f[1]*l+d[1]*g;X=a[1]*t-f[1]*q+d[1]*v;S=a[1]*l-b[1]*q+d[1]*k;Z=a[1]*g-b[1]*v+f[1]*k;_Y=a[0]*W-b[0]*X+f[0]*S-d[0]*Z;W=b[1]*w-c[1]*g+f[1]*m;X=a[1]*w-c[1]*v+f[1]*n;Y=a[1]*g-b[1]*v+f[1]*k;S=a[1]*m-b[1]*n+c[1]*k;_Z=a[0]*W-b[0]*X+c[0]*Y-f[0]*S;return[_W/_S,_X/_S,_Y/_S,_Z/_S]}var Popup=Popup||{};
Popup.setHeader=function(a){a?(Popup.elements.popupHeader.style.display="",Popup.elements.popupHeader.innerText=a):Popup.elements.popupHeader.style.display="none"};Popup.elements={};Popup.onEnterCallback=null;Popup.setBody=function(a){Popup.elements.popupBody.innerText=a};Popup.setBodyHTML=function(a){Popup.elements.popupBody.innerHTML=a};Popup.clearBottom=function(){Popup.elements.popupBottom.innerHTML=""};
Popup.addButton=function(a,b,c){var d=document.createElement("div");d.setAttribute("id","__popup_button_"+(+new Date).toString("32"));d.className="button button-"+c;d.append(document.createTextNode(a));d.onclick=b;Popup.elements.popupBottom.append(d)};
Popup.create=function(){document.getElementById("overlay")||(Popup.elements.overlay=document.createElement("div"),Popup.elements.overlay.setAttribute("id","overlay"),Popup.elements.popup=document.createElement("div"),Popup.elements.popup.setAttribute("id","popup"),Popup.elements.popupContainer=document.createElement("div"),Popup.elements.popupContainer.setAttribute("id","popup-container"),Popup.elements.popupHeader=document.createElement("div"),Popup.elements.popupHeader.setAttribute("id","popup-header"),
Popup.elements.popupBody=document.createElement("div"),Popup.elements.popupBody.setAttribute("id","popup-body"),Popup.elements.popupBottom=document.createElement("div"),Popup.elements.popupBottom.setAttribute("id","popup-bottom"),Popup.elements.popupContainer.append(Popup.elements.popupHeader),Popup.elements.popupContainer.append(Popup.elements.popupBody),Popup.elements.popupContainer.append(Popup.elements.popupBottom),Popup.elements.popup.append(Popup.elements.popupContainer),Popup.elements.overlay.append(Popup.elements.popup),
document.body.append(Popup.elements.overlay))};Popup.visible=function(a){a?(Popup.elements.overlay.style.display="table",setTimeout(function(){Popup.elements.overlay.style.opacity="1"},200)):(Popup.elements.overlay.style.opacity="0",setTimeout(function(){Popup.elements.overlay.style.display="none"},200))};
Popup.show=function(a){return new Promise(function(b,c){Popup.create();Popup.clearBottom();Popup.setHeader(a.header);a.onEnterCallback&&"function"===typeof a.onEnterCallback&&(Popup.onEnterCallback=a.onEnterCallback);a.body&&Popup.setBody(a.body);a.bodyHTML&&Popup.setBodyHTML(a.bodyHTML);document.addEventListener("keydown",Popup.keydown);a.preventClose||Popup.addButton("Cerrar",Popup.hide,"secondary");a.buttons&&a.buttons.forEach(function(a){Popup.addButton(a.text,a.callback,a.type||"default")});
Popup.visible(!0);b()})};Popup.keydown=function(a){a=a||window.event;13==a.keyCode&&(Popup.onEnterCallback?(Popup.onEnterCallback(),Popup.onEnterCallback=null):Popup.hide())};Popup.hide=function(){document.removeEventListener("keydown",Popup.keydown);Popup.visible(!1)};var UI=UI||{};UI.scrollMenuListener=null;UI.currentSelected=[];UI.currentSubmenu=null;UI.imageLoaded=!1;UI.isImageLoaded=function(){return UI.imageLoaded};
UI.setImageLoaded=function(a){document.getElementById("canvas_info")&&(document.getElementById("canvas_info").style.display=a?"none":"");document.getElementById("image_main")&&(document.getElementById("image_main").style.display=a?"":"none");UI.imageLoaded=!!a};
UI.loadingHandler=function(){if(!document.getElementById("loading-bar")){var a=document.createElement("div");a.setAttribute("id","loading-bar");var b=document.createElement("div");b.setAttribute("id","loading-bar-container");var c=document.createElement("div");c.setAttribute("id","loading-bar-loader");b.append(c);a.append(b);document.body.append(a);return{load:function(){},set:function(a){100<a&&(a=100);0>a&&(a=0);setTimeout(function(){document.getElementById("loading-bar-loader").style.width=a+"%"},
0)},end:function(){this.set(100);setTimeout(function(){document.body.removeChild(a)},200)}}}};UI.closeSubmenu=function(a){document.getElementById("submenu_"+a).style.transform="translateY(-100%)";setTimeout(function(){document.getElementById("submenu_"+a).style.display="none"},200)};
UI.openSubmenu=function(a){var b=document.getElementById("submenu_"+a);a=b.children.length;for(var c=0,d=b.children[0];c<a;){if(-1<b.children[c].className.indexOf("selected")){d=b.children[c];break}c++}b.style.display="block";UI.selectAdjust(d);setTimeout(function(){b.style.transform="translateY(0%)"},200)};
UI.selectAdjust=function(a){if(a.getAttribute("data-submenu"))UI.currentSubmenu&&UI.currentSubmenu!==a.getAttribute("data-submenu")&&UI.closeSubmenu(UI.currentSubmenu),UI.currentSubmenu=a.getAttribute("data-submenu"),UI.openSubmenu(a.getAttribute("data-submenu"));else if(UI.currentSubmenu&&0>a.parentElement.className.indexOf("submenu")&&UI.closeSubmenu(UI.currentSubmenu),a.getAttribute("data-item")&&(current_adjust.paramName=a.getAttribute("data-item")),current_adjust.max=parseFloat(a.getAttribute("max")),
current_adjust.min=parseFloat(a.getAttribute("min")),current_adjust.callbacks=a.getAttribute("data-callback")||"",a=document.getElementById("cantidad"))a.innerHTML=Locale.get(current_adjust.paramName)+": "+Math.round(100*Params.get(current_adjust.paramName))/100};UI.dataActionClick=function(a){var b=a.target;console.log(a.target);b.getAttribute("data-action")&&(a=b.getAttribute("data-action"),window.Actions[a]())};
UI.rangeDblClick=function(a){a.stopPropagation();this.value=Params.getDefault(this.getAttribute("data-item"));Actions.setParam({paramName:this.getAttribute("data-item"),value:parseFloat(this.value),callbacks:this.getAttribute("data-callback"),save:!0});a.preventDefault()};UI.moveRange_timer={to:null,param:null};
UI.moveRange=function(a){var b=this;UI.moveRange_timer.to&&UI.moveRange_timer.to==this.getAttribute("data-item")&&clearTimeout(UI.moveRange_timer.to);UI.moveRange_timer.param=this.getAttribute("data-item");UI.moveRange_timer.to=setTimeout(function(){Actions.setParam({paramName:b.getAttribute("data-item"),value:parseFloat(b.value),callbacks:b.getAttribute("data-callback"),save:!0})},30)};
UI.scrollMenu=function(a){var b=a.target;if(!(0>a.target.className.indexOf("menu"))){var c=Math.round(__NUM_OF_MENU_ITEMS__*this.scrollLeft/document.body.offsetWidth);c+=__MENU_ITEMS_PADDING__;UI.scrollMenuListener&&clearTimeout(UI.scrollMenuListener);UI.scrollMenuListener=setTimeout(function(){UI.selectMenuItem(c,b)},150)}};UI.clickMenuContainer=function(a){this.parentElement.classList.contains("open")?this.parentElement.classList.remove("open"):this.parentElement.classList.add("open")};
UI.dropFile=function(a){a=a||window.event;a.preventDefault();a.stopPropagation();document.body.style.opacity=1;try{loadImageFromUrl(URL.createObjectURL(a.dataTransfer.files[0]))}catch(b){console.log(b),__ERROR("No se pudo cargar la imagen al arrastrarla, por favor, utilice el bot\u00f3n de abrir.")}};
var __SHADERS__={VERTEX:"attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() { vec2 dist = a_position / u_resolution; gl_Position = vec4( (dist * 2.0 - 1.0) * vec2(1, -1), 0, 1); v_texCoord = a_texCoord;}",FRAGMENT:"/** * David Iglesias. All rights reserved */ precision mediump float; uniform sampler2D u_image; uniform vec2 u_textureSize; uniform float u_kernel[25]; uniform float u_kernelWeight; uniform sampler2D u_lut; uniform float u_saturation; uniform float u_brightness; uniform float u_exposure; uniform float u_contrast; uniform float u_dehaze; uniform float u_atmosferic_light; uniform float u_masking; uniform vec3 u_temptint[3]; uniform float u_bAndW; uniform float u_hdr; varying vec2 v_texCoord; void main() { vec2 pixel_size = vec2(1.0, 1.0) / u_textureSize; vec3 center = texture2D(u_image, v_texCoord).rgb; vec4 colorSum = texture2D(u_image, v_texCoord + pixel_size * vec2(-2, -2)) * u_kernel[0] + texture2D(u_image, v_texCoord + pixel_size * vec2( -1, -2))* u_kernel[1] + texture2D(u_image, v_texCoord + pixel_size * vec2( 0, -2)) * u_kernel[2] + texture2D(u_image, v_texCoord + pixel_size * vec2( 1, -2)) * u_kernel[3] + texture2D(u_image, v_texCoord + pixel_size * vec2( 2, -2)) * u_kernel[4] + texture2D(u_image, v_texCoord + pixel_size * vec2( -2, -1))* u_kernel[5] + texture2D(u_image, v_texCoord + pixel_size * vec2(-1, -1)) * u_kernel[6] + texture2D(u_image, v_texCoord + pixel_size * vec2( 0, -1)) * u_kernel[7] + texture2D(u_image, v_texCoord + pixel_size * vec2( 1, -1)) * u_kernel[8] + texture2D(u_image, v_texCoord + pixel_size * vec2( 2, -1)) * u_kernel[9] + texture2D(u_image, v_texCoord + pixel_size * vec2( -2, 0)) * u_kernel[10] + texture2D(u_image, v_texCoord + pixel_size * vec2(-1, 0)) * u_kernel[11] + texture2D(u_image, v_texCoord + pixel_size * vec2( 0, 0)) * u_kernel[12] + texture2D(u_image, v_texCoord + pixel_size * vec2( 1, 0)) * u_kernel[13] + texture2D(u_image, v_texCoord + pixel_size * vec2( 2, 0)) * u_kernel[14] + texture2D(u_image, v_texCoord + pixel_size * vec2(-2, 1)) * u_kernel[15] + texture2D(u_image, v_texCoord + pixel_size * vec2(-1, 1)) * u_kernel[16] + texture2D(u_image, v_texCoord + pixel_size * vec2( 0, 1)) * u_kernel[17] + texture2D(u_image, v_texCoord + pixel_size * vec2( 1, 1)) * u_kernel[18] + texture2D(u_image, v_texCoord + pixel_size * vec2( 2, 1)) * u_kernel[19] + texture2D(u_image, v_texCoord + pixel_size * vec2(-2, 2)) * u_kernel[20] + texture2D(u_image, v_texCoord + pixel_size * vec2(-1, 2)) * u_kernel[21] + texture2D(u_image, v_texCoord + pixel_size * vec2( 0, 2)) * u_kernel[22] + texture2D(u_image, v_texCoord + pixel_size * vec2( 1, 2)) * u_kernel[23] + texture2D(u_image, v_texCoord + pixel_size * vec2( 2, 2)) * u_kernel[24]; vec3 rgb_pix = mix(center, (colorSum.rgb / u_kernelWeight), u_masking); float _max = max(rgb_pix.r, max(rgb_pix.g, rgb_pix.b)); float _min = min(rgb_pix.r, min(rgb_pix.g, rgb_pix.b)); vec2 sv_pixel = vec2(1.0 - _min / _max, _max); sv_pixel.y = clamp(texture2D(u_lut, vec2(sv_pixel.y, 0.0)).a, 0.0, 1.0); if (u_saturation != 0.0) { sv_pixel.x *= (1.0 + u_saturation); } sv_pixel.x = clamp(sv_pixel.x, 0.0, 1.0); if (u_brightness != 0.0) { sv_pixel.y = pow(sv_pixel.y, 1.0 - u_brightness * 0.6); } if (u_hdr != 0.0) { sv_pixel.y = mix(sv_pixel.y, clamp(1.0 - pow(1.0 - pow(sv_pixel.y, 0.3), 0.42), 0.0, 1.0), u_hdr); } sv_pixel = clamp(sv_pixel, 0.0, 1.0); if (sv_pixel.x > 0.0) { float k = - sv_pixel.x / (1.0 - _min / _max); rgb_pix = (_max - rgb_pix) * k + _max; rgb_pix *= sv_pixel.y / _max; } else { rgb_pix.r = rgb_pix.g = rgb_pix.b = sv_pixel.y; } if (u_dehaze != 0.0) { float t = 1.0 / 25.0; vec4 center = texture2D(u_image, v_texCoord); vec2 pixel_size = vec2(1.0, 1.0) / u_textureSize; float dark = 1.0; const int radius = 1; for (int ii = -radius; ii <= radius; ii++ ) { for(int jj = -radius; jj <= radius; jj++) { vec4 pix = texture2D(u_image, v_texCoord + pixel_size * vec2( ii, jj)); float _min = min(pix.r, min(pix.g, pix.b)); if (dark > _min) { dark = _min; } } } float darkPix = min(center.r, min(center.g, center.b)); float diff = abs(darkPix - dark); float mask = pow(diff, 3.0); dark = mix(darkPix, dark, mask); float mm = max(1.0 - dark, 0.2); rgb_pix = mix(rgb_pix, ((rgb_pix - u_atmosferic_light) / mm + u_atmosferic_light), u_dehaze); } rgb_pix += u_exposure; rgb_pix = clamp(rgb_pix, 0.0, 1.0); float contrast = u_contrast + 1.0; rgb_pix = contrast * (rgb_pix - 0.5) + 0.5; rgb_pix *= u_temptint[0]; float mono = dot(rgb_pix, vec3(0.2126, 0.7152, 0.0722)); rgb_pix += mix(u_temptint[2], u_temptint[1], mono); if (u_bAndW != 0.0) { rgb_pix = mix(rgb_pix, vec3(mono, mono, mono), u_bAndW); } gl_FragColor = vec4(rgb_pix, 1.0); }"},
Locale=Locale||{};
Locale.dict={es:{exposure:"Exposici\u00f3n",contrast:"Contraste",brightness:"Brillo",whites:"Claros",highlights:"Luces",shadows:"Sombras",blacks:"Oscuros",temperature:"Temperatura",tint:"Matiz",saturation:"Saturaci\u00f3n",vibrance:"Vibrancia",bAndW:"Blanco y negro",sharpen:"Detalles",sharpen_radius:"Radio de detalle",masking:"M\u00e1scara",radiance:"Radiancia",dehaze:"Niebla",atmosferic_light:"Luz atmosf\u00e9rica",hdr:"Alto rango din\u00e1mico",lightColor:"Color",lightFill:"Cantidad",lightSat:"Cantidad",
darkColor:"Color",darkFill:"Cantidad",darkSat:"Cantidad",image_no_loaded:"No hay ninguna imagen cargada. Para editar, cargue una imagen.",image_save_title:"\u00bfDesea guardar la imagen?",image_save_text:"Nombre de la imagen (Resoluci\u00f3n m\u00e1xima: 10Mpx) :"}};Locale.current="es";Locale.get=function(a){return Locale.dict[Locale.current][a]?Locale.dict[Locale.current][a]:a};var Params=Params||{};
Params.params={hdr:0,exposure:0,temperature:0,tint:0,brightness:0,saturation:0,contrast:0,sharpen:0,masking:.5,sharpen_radius:1,radiance:0,highlights:0,shadows:0,whites:0,blacks:0,dehaze:0,bAndW:0,atmosferic_light:.7,lightFill:0,lightColor:0,lightSat:1,darkFill:0,darkColor:0,darkSat:1};Params.default=function(a){var b={};Object.keys(a).forEach(function(c){b[c]=a[c]});return b}(Params.params);Params.get=function(a){return Params.params[a]};
Params.reset=function(a){Object.keys(Params.params).forEach(function(a){Params.params[a]=Params.default[a]})};Params.set=function(a,b){Params.params[a]=parseFloat(b)};Params.getDefault=function(a){return Params.default[a]};window.addEventListener("onload",function(){if("serviceWorker"in navigator)try{navigator.serviceWorker.register("/serviceWorker.js"),console.log("NONE")}catch(a){}});
var __NUM_OF_MENU_ITEMS__=5,__MENU_ITEMS_PADDING__=Math.floor((__NUM_OF_MENU_ITEMS__-1)/2),CURRENT_IMAGE_TRANSFORMATIONS={x:0,y:0,scale:1,originX:null,originY:null,deltaX:0,deltaY:0};window.onerror=function(a,b,c){__ERROR("Error: "+a+" en la url: "+b+", en la L\u00ednea:"+c)};
function setElementDraggable(a){function b(b){if(!(0>a.className.indexOf("scaled"))){b=b||window.event;b.preventDefault();var c=d-b.clientX,h=f-b.clientY;d=b.clientX;f=b.clientY;a.style.top=a.offsetTop-h+"px";a.style.left=a.offsetLeft-c+"px"}}function c(){document.onmouseup=null;document.onmousemove=null}var d=0,f=0;a.addEventListener("mousedown",function(a){a=a||window.event;a.preventDefault();d=a.clientX;f=a.clientY;document.onmouseup=c;document.onmousemove=b})}
window.addEventListener("load",function(a){if(isMobile())document.body.innerHTML="Loading...",document.body.style.background="#000",location.href="mobile.html";else{var b=document.getElementsByClassName("data-action");for(a=b.length;a--;)b[a].addEventListener("click",UI.dataActionClick);b=document.getElementById("image_main");setElementDraggable(b);var c=document.getElementsByClassName("menu-container-title");for(a=c.length;a--;)c[a].addEventListener("click",UI.clickMenuContainer);c=document.getElementsByClassName("range");
for(a=c.length;a--;)c[a].addEventListener("dblclick",UI.rangeDblClick),c[a].addEventListener("input",UI.moveRange);document.addEventListener("drop",UI.dropFile);document.addEventListener("dragover",function(a){a.preventDefault();a.stopPropagation();document.body.style.opacity=.7});document.addEventListener("dragend",function(a){a.preventDefault();a.stopPropagation();document.body.style.opacity=1});document.getElementById("image-open").addEventListener("click",function(){document.getElementById("image_data").click()});
(function(a){var b=0;a.addEventListener("click",function(c){300>+new Date-b?-1<a.className.indexOf("scaled")?(a.className=a.className.replace(" scaled",""),a.style.position="",a.style.transformOrigin="",a.style.transform=""):(a.className+=" scaled",a.style.top=a.offsetLeft+"px",a.style.left=a.offsetLeft+"px",a.style.position="absolute",a.style.transformOrigin=" "+(c.clientX-a.offsetLeft)+"px "+(c.clientY-a.offsetTop)+"px",a.style.transform="scale(2.1)"):b=+new Date})})(b);document.getElementById("image-save").addEventListener("click",
function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(a){return a.yield(window.Actions.download({limit:2E3}),0)})});__BOOT__()}});
